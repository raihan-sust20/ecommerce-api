┌────────────────────────────────────────┐
│            Frontend Clients            │
│                                        │
│  - Next.js (Vercel)                    │
│  - Local Dev (localhost:3000)          │
│  - Admin / Swagger UI                  │
└───────────────────────┬────────────────┘
                        │ HTTPS (CORS)
                        ▼
┌────────────────────────────────────────-┐
│          Express.js Application         │
│                                         │
│  ┌──────────────────────────────────┐   │
│  │  CORS Middleware                  │  │
│  │  - Origin whitelist               │  │
│  │  - OPTIONS preflight              │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Helmet                           │  │
│  │  - Security headers               │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Trust Proxy (ngrok / LB)         │  │
│  │  - X-Forwarded-For                │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Compression                      │  │
│  │  - gzip / brotli                  │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Rate Limiter                     │  │
│  │  - IP based (proxy-aware)         │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Stripe Webhook (Raw Body)        │  │
│  │  - /api/v1/webhooks/stripe        │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Body Parsers                     │  │
│  │  - JSON                           │  │
│  │  - URL Encoded                    │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Passport (JWT)                   │  │
│  │  - Token verification             │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Request Logger                   │  │
│  │  - Method + path                  │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Controllers (Routes)             │  │
│  │  - Auth                           │  │
│  │  - Products                       │  │
│  │  - Categories                     │  │
│  │  - Orders                         │  │
│  │  - Payments                       │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Services (Business Logic)        │  │
│  |  - Auth                           │  │
│  │  - Products                       │  │
│  │  - Categories                     │  │
│  │  - Orders                         │  │
│  │  - Payments                       │  │
│  └─────────────────┬────────────────┘   │
│                    ▼                    │
│  ┌──────────────────────────────────-┐  │
│  │  Repositories (TypeORM)           │  │
│  │  - Users                          │  │
│  │  - Products                       │  │
│  │  - Categories                     │  │
│  │  - Orders                         │  │
│  │  - Payments                       │  │
│  └─────────────────┬────────────────-┘  │
│                    ▼                    │
│  ┌──────────────────────────────────┐   │
│  │  Database                         │  │
│  │  - PostgreSQL                     │
│  └──────────────────────────────────┘   │
│                                         │
│  ┌──────────────────────────────────┐   │
│  │  Error Handling                   │  │
│  │  - 404 Not Found                  │  │
│  │  - Global Error Handler           │  │
│  └──────────────────────────────────┘   │
└────────────────────────────────────────-┘
